expression_of_interest <- expression_data %>% dplyr::select(all_of(cohort_bsid)) %>%
tibble::rownames_to_column("GeneSymbol") %>%
dplyr::filter(GeneSymbol ==x) %>%
tibble::column_to_rownames("GeneSymbol") %>%
t() %>% as.data.frame() %>%
tibble::rownames_to_column("Kids_First_Biospecimen_ID")
cohort_bsid <- cohort_df %>% pull(Kids_First_Biospecimen_ID) %>% unique()
#### Filter to the cancer group of interest -----------------------------------
cancer_group_long <- short_long_match %>%
filter(short_name %in% cancer_group_list) %>%
pull(long_name)
cancer_group_list <- c("LGG", "HGG")
#### Filter to the cancer group of interest -----------------------------------
cancer_group_long <- short_long_match %>%
filter(short_name %in% cancer_group_list) %>%
pull(long_name)
cohort_df <- histology_df %>% dplyr::filter(tumor_descriptor == "Initial CNS Tumor") %>%
dplyr::filter(experimental_strategy=="RNA-Seq") %>%
dplyr::filter(cancer_group %in% cancer_group_long) %>%
dplyr::select(Kids_First_Biospecimen_ID, harmonized_diagnosis)
#### Generate figures and statistics for each gene ----------------------------------
anova_results <- data.frame()
tukey_results <- data.frame()
cohort_bsid <- cohort_df %>% pull(Kids_First_Biospecimen_ID) %>% unique()
expression_of_interest <- expression_data %>% dplyr::select(all_of(cohort_bsid)) %>%
tibble::rownames_to_column("GeneSymbol") %>%
dplyr::filter(GeneSymbol ==x) %>%
tibble::column_to_rownames("GeneSymbol") %>%
t() %>% as.data.frame() %>%
tibble::rownames_to_column("Kids_First_Biospecimen_ID")
#annotate relevant clinical information to the expression data frame
combined <- expression_of_interest %>% dplyr::left_join(cohort_df) %>%
dplyr::rename(gene_of_interest = x)
# get ready for calculating statistics
combined_fixed <- combined %>% mutate(harmonized_diagnosis = gsub("-","_", harmonized_diagnosis))
# calculate statistics
res_aov <- aov(combined_fixed$gene_of_interest ~ combined_fixed$harmonized_diagnosis,
data = combined_fixed)
summary(res_aov)
anova_result <- summary(res_aov)[[1]] %>%
tibble::rownames_to_column() %>%
mutate(gene = x)
anova_results <- rbind(anova_results, anova_result)
tukey.test<-TukeyHSD(res_aov)[1] %>% as.data.frame() %>% tibble::rownames_to_column()
colnames(tukey.test) <- c("Pair Compared", "DIFF", "LWR", "UPR", "P.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(y.position = seq(10, 20, length.out = nrow(tukey.test))) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj, y.position) %>% tibble()
View(tukey_test_mapped)
n_sample_hd <- combined_fixed %>% group_by(harmonized_diagnosis) %>% summarize(n=n())
combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(myaxis = paste0(harmonized_diagnosis, "\n", "n=", n)) %>%
ggplot( aes(x=myaxis, y=gene_of_interest, fill=harmonized_diagnosis)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
library(ggpubr)
combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(myaxis = paste0(harmonized_diagnosis, "\n", "n=", n)) %>%
ggplot( aes(x=myaxis, y=gene_of_interest, fill=harmonized_diagnosis)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(myaxis = paste0(harmonized_diagnosis, "\n", "n=", n)) %>%
ggplot( aes(x=myaxis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(y.position = seq(100, 400, length.out = nrow(tukey.test))) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj, y.position) %>% tibble()
n_sample_hd <- combined_fixed %>% group_by(harmonized_diagnosis) %>% summarize(n=n())
combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(myaxis = paste0(harmonized_diagnosis, "\n", "n=", n)) %>%
ggplot( aes(x=myaxis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(myaxis = paste0(harmonized_diagnosis, "\n", "n=", n)) %>%
ggplot( aes(x=myaxis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
View(tukey_test_mapped)
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(y.position = seq(100, 400, length.out = nrow(tukey.test))) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj, y.position) %>% tibble() %>%
filter(p.adj <=0.05)
combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(myaxis = paste0(harmonized_diagnosis, "\n", "n=", n)) %>%
ggplot( aes(x=myaxis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj, y.position) %>% tibble() %>%
filter(p.adj <=0.05)
tukey_test_mapped <- tukey_test_mapped %>%
mutate(y.position = seq(100, 400, length.out = nrow(tukey_test_mapped)))
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05)
tukey_test_mapped <- tukey_test_mapped %>%
mutate(y.position = seq(100, 400, length.out = nrow(tukey_test_mapped)))
n_sample_hd <- combined_fixed %>% group_by(harmonized_diagnosis) %>% summarize(n=n())
combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(myaxis = paste0(harmonized_diagnosis, "\n", "n=", n)) %>%
ggplot( aes(x=myaxis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey_test_mapped %>%
mutate(y.position = seq(100, 400, length.out = nrow(tukey_test_mapped))) %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(group1 = paste0(group1, "\n", "n=", n),
group2 = paste0(group2, "\n", "n=", n))
View(n_sample_hd)
# get ready for calculating statistics
combined_fixed <- combined %>% mutate(harmonized_diagnosis = gsub("-","_", harmonized_diagnosis))
n_sample_hd <- combined_fixed %>% group_by(harmonized_diagnosis) %>% summarize(n=n())
combined_fixed <- combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(myaxis = paste0(harmonized_diagnosis, "\n", "n=", n))
View(combined_fixed)
# get ready for calculating statistics
combined_fixed <- combined %>% mutate(harmonized_diagnosis = gsub("-","_", harmonized_diagnosis))
n_sample_hd <- combined_fixed %>% group_by(harmonized_diagnosis) %>% summarize(n=n())
combined_fixed <- combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(harmonized_diagnosis = paste0(harmonized_diagnosis, "\n", "n=", n))
View(combined_fixed)
# calculate statistics
res_aov <- aov(combined_fixed$gene_of_interest ~ combined_fixed$harmonized_diagnosis,
data = combined_fixed)
summary(res_aov)
anova_result <- summary(res_aov)[[1]] %>%
tibble::rownames_to_column() %>%
mutate(gene = x)
anova_results <- rbind(anova_results, anova_result)
tukey.test<-TukeyHSD(res_aov)[1] %>% as.data.frame() %>% tibble::rownames_to_column()
colnames(tukey.test) <- c("Pair Compared", "DIFF", "LWR", "UPR", "P.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05)
View(tukey_test_mapped)
tukey_test_mapped <- tukey_test_mapped %>%
mutate(y.position = seq(200, 400, length.out = nrow(tukey_test_mapped)))
combined_fixed %>%
ggplot( aes(x=myaxis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
View(combined_fixed)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey_test_mapped %>% round(p.adj,digits=3)
tukey_test_mapped$p.adj <- round(tukey_test_mapped$p.adj, digits=4)
View(tukey_test_mapped)
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05) %>%
mutate(y.position = seq(200, 400, length.out = nrow(tukey_test_mapped)))
tukey_test_mapped$p.adj <- round(tukey_test_mapped$p.adj, digits=6)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05) %>%
mutate(y.position = seq(median(combined_fixed$gene_of_interest), max(combined_fixed$gene_of_interest), length.out = nrow(tukey_test_mapped)))
tukey_test_mapped$p.adj <- round(tukey_test_mapped$p.adj, digits=6)
p<-combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05) %>%
mutate(y.position = seq(1.5*median(combined_fixed$gene_of_interest), 1.5*max(combined_fixed$gene_of_interest), length.out = nrow(tukey_test_mapped)))
tukey_test_mapped$p.adj <- round(tukey_test_mapped$p.adj, digits=6)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05) %>%
mutate(y.position = seq(max(combined_fixed$gene_of_interest), 1.5*max(combined_fixed$gene_of_interest), length.out = nrow(tukey_test_mapped)))
tukey_test_mapped$p.adj <- round(tukey_test_mapped$p.adj, digits=6)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05) %>%
mutate(y.position = seq(0.8*max(combined_fixed$gene_of_interest), 1.2*max(combined_fixed$gene_of_interest), length.out = nrow(tukey_test_mapped)))
tukey_test_mapped$p.adj <- round(tukey_test_mapped$p.adj, digits=6)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05) %>%
mutate(y.position = seq(0.7*max(combined_fixed$gene_of_interest), 1.2*max(combined_fixed$gene_of_interest), length.out = nrow(tukey_test_mapped)))
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.05) %>%
mutate(y.position = seq(0.7*max(combined_fixed$gene_of_interest), 1.1*max(combined_fixed$gene_of_interest), length.out = nrow(tukey_test_mapped)))
tukey_test_mapped$p.adj <- round(tukey_test_mapped$p.adj, digits=6)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=FALSE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
ggplot(tukey_test_mapped, aes(group1, group2, fill= p.adj)) +
geom_tile()
View(tukey.test)
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj)
View(tukey_test_mapped)
ggplot(tukey_test_mapped, aes(group1, group2, fill= p.adj)) +
geom_tile()
ggplot(tukey.test, aes(group1, group2, fill= p.adj)) +
geom_tile() +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(tukey.test, aes(group1, group2, fill= p.adj)) +
geom_tile() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(tukey.test, aes(group1, group2)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(tukey_test_mapped, aes(group1, group2, fill= p.adj)) +
geom_tile() +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
tukey_test_heatmap <- tukey_test_mapped %>%
mutate(group1 = gsub("\n", " ", group1),
group2 = gsub("\n", " ", group1))
ggplot(tukey_test_heatmap, aes(group1, group2, fill= p.adj)) +
geom_tile() +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
View(tukey_test_heatmap)
tukey_test_heatmap <- tukey_test_mapped %>%
mutate(group1 = gsub("\n", " ", group1),
group2 = gsub("\n", " ", group1)) %>%
ggplot(aes(group1, group2, fill= p.adj)) +
geom_tile() +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
tukey_test_heatmap <- tukey_test_mapped %>%
mutate(group1 = gsub("\n", " ", group1),
group2 = gsub("\n", " ", group1)) %>%
ggplot(aes(group1, group2, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(tukey_test_mapped, aes(group1, group2, fill= p.adj)) +
+   geom_tile()
ggplot(tukey_test_mapped, aes(group1, group2, fill= p.adj))
+   geom_tile()
ggplot(tukey_test_mapped, aes(group1, group2, fill= p.adj)) +  geom_tile()
tukey_test_mapped %>%
mutate(group1 = gsub("\n", " ", group1),
group2 = gsub("\n", " ", group1)) %>%
ggplot(aes(group1, group2, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
tukey_test_mapped %>%
mutate(group1_relabel = gsub("\n", " ", group1),
group2_relabel = gsub("\n", " ", group1)) %>%
ggplot(aes(group1_relabel, group2_relabel, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
tukey_test_mapped %>%
mutate(group1_relabel = gsub("\n", " ", group1),
group2_relabel = gsub("\n", " ", group1)) %>%
ggplot(aes(x=group1_relabel, group2_relabel, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
View(tukey_test_heatmap)
View(tukey_test_heatmap)
tukey_test_heatmap <- tukey_test_mapped %>%
mutate(group1_relabel = gsub("\n", " ", group1),
group2_relabel = gsub("\n", " ", group1))
View(tukey_test_heatmap)
tukey_test_mapped %>%
mutate(group1_relabel = gsub("\n", " ", group1),
group2_relabel = gsub("\n", " ", group1)) %>%
ggplot(aes(x=group1_relabel, group2_relabel, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
tukey_test_mapped %>%
mutate(group1_relabel = gsub("\n", " ", group1),
group2_relabel = gsub("\n", " ", group1)) %>%
ggplot(tukey_test_mapped, aes(x=group1_relabel, group2_relabel, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
tukey_test_mapped %>%
mutate(group1_relabel = gsub("\n", " ", group1),
group2_relabel = gsub("\n", " ", group1)) %>%
ggplot(tukey_test_mapped, aes(x=group1_relabel, group2_relabel, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
tukey_test_mapped %>%
mutate(group1_relabel = gsub("\n", " ", group1),
group2_relabel = gsub("\n", " ", group1)) %>%
ggplot(tukey_test_mapped, aes(x=group1, group2, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
# get ready for calculating statistics
combined_fixed <- combined %>% mutate(harmonized_diagnosis = gsub("-","_", harmonized_diagnosis))
n_sample_hd <- combined_fixed %>% group_by(harmonized_diagnosis) %>% summarize(n=n())
combined_fixed <- combined_fixed %>%
dplyr::left_join(n_sample_hd) %>%
dplyr::mutate(harmonized_diagnosis = paste0(harmonized_diagnosis, " ", "n=", n))
# calculate statistics
res_aov <- aov(combined_fixed$gene_of_interest ~ combined_fixed$harmonized_diagnosis,
data = combined_fixed)
summary(res_aov)
anova_result <- summary(res_aov)[[1]] %>%
tibble::rownames_to_column() %>%
mutate(gene = x)
anova_results <- rbind(anova_results, anova_result)
tukey.test<-TukeyHSD(res_aov)[1] %>% as.data.frame() %>% tibble::rownames_to_column()
colnames(tukey.test) <- c("Pair Compared", "DIFF", "LWR", "UPR", "P.adj")
tukey_test_mapped <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj) %>%
mutate(.y. = "harmonized_diagnosis") %>%
dplyr::select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.01)
tukey_test_mapped <- tukey_test_mapped %>%
mutate(y.position = seq(0.6*max(combined_fixed$gene_of_interest), 1.5*max(combined_fixed$gene_of_interest), length.out = nrow(tukey_test_mapped)))
tukey_test_mapped$p.adj <- round(tukey_test_mapped$p.adj, digits=6)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=TRUE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F,aes(fill=harmonized_diagnosis)) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_mapped, label = "p.adj")
ggplot(tukey_test_mapped, aes(x=group1, group2, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
View(tukey.test)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=TRUE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F,aes(fill=harmonized_diagnosis)) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_violin label = "p.adj")
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=TRUE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F,aes(fill=harmonized_diagnosis)) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_violin, label = "p.adj")
tukey.test<-TukeyHSD(res_aov)[1] %>% as.data.frame() %>% tibble::rownames_to_column()
colnames(tukey.test) <- c("Pair Compared", "DIFF", "LWR", "UPR", "P.adj")
tukey_test_heatmap <- tukey.test %>% arrange(P.adj, descending = TRUE) %>%
mutate(gene=x) %>%
tidyr::separate(col = `Pair Compared`, into = c("group1", "group2"), sep = "-") %>%
rename(p.adj = P.adj)
tukey_test_violin <- tukey_test_heatmap %>%
mutate(.y. = "harmonized_diagnosis") %>%
dplyr::select(.y., group1, group2, p.adj) %>% tibble() %>%
filter(p.adj <=0.01) %>%
mutate(y.position = seq(0.6*max(combined_fixed$gene_of_interest), 1.5*max(combined_fixed$gene_of_interest), length.out = nrow(tukey_test_mapped)))
tukey_test_violin$p.adj <- round(tukey_test_violin$p.adj, digits=6)
combined_fixed %>%
ggplot( aes(x=harmonized_diagnosis, y=gene_of_interest)) +
geom_violin(width=1.4, trim=TRUE, show.legend = F, aes(fill=harmonized_diagnosis)) +
geom_boxplot(width=0.1, color="black", show.legend = F,aes(fill=harmonized_diagnosis)) +
labs(title=paste0(x," TPM per Harmonized Diagnosis"),x="Harmonized Diagnosis", y = paste0(x," TPM Value")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
stat_pvalue_manual(tukey_test_violin, label = "p.adj")
ggplot(tukey_test_heatmap, aes(x=group1, group2, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
tukey_test_heatmap_filled <- tukey_test_heatmap %>%
rename(group2=group1,
group1=group2)
tukey_heatmap_complete <- rbind(tukey_test_heatmap, tukey_test_heatmap_filled)
ggplot(tukey_heatmap_complete, aes(x=group1, group2, fill= p.adj)) +
geom_tile(aes(fill=p.adj)) +
labs(title=paste0(x," Harmonized Diagnosis Tukey Test for TPM"),x="Harmonized Diagnosis", y = "Harmonized Diagnosis") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
